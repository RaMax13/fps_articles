# FPS объяснение:

Предисловие. Некоторые Gayмеры говорят, что надо устанавливать FPS больше, чем частота монитора. Почему? Потому. В данной статье я попытаюсь сам себе объяснить, верный ли это поступок или не верный. Я, как и все, могу ошибаться. С радостью послушаю дельные советы и объяснения, в чем именно косяк. Но только не «я попробовал и мне показалось», а конкретно «в таком-то абзаце имеется техническая неточность, потому что в источнике таком-то написано так-то»(и ссылку на источник).

## Термины и определения:
* FPS - Frames per second - показывает, сколько кадров в секунду сгенерировала видеокарта. Показатель зависит от сложности кадра и аппаратных мощностей ПК. Чем менее сложен кадр, и чем мощнее аппаратная составляющая ПК(CPU, GPU, RAM и т.д.), тем больше кадров способна сгенерировать видеокарта.
* Var в CS GO рядом с fps: стандартное отклонение частоты смены кадров у пользователя, измеренное в миллисекундах, на выборке последних 1000 кадров. Чем сильнее амплитуда перепадов FPS, тем выше будет показатель var.
* Время кадра - время, в течение которого кадр оставался самым актуальным. Измеряется в миллисекундах (мс).
* Время формирования кадра - промежуток времени, который был потрачен на формирование нового кадра видеокартой. Измеряется в миллисекундах(мс).
* Частота монитора - показывает, сколько раз в секунду монитор будет обновлен от левого верхнего пикселя до нижнего правого. Измеряется в герцах (Гц).
* Мгновенный FPS = 1000(мс) / Время формирования кадра(мс). Мгновенный FPS показывает, каким мог бы быть FPS, если бы все остальные кадры формировались за одинаковое время.

* Период обновления монитора - величина, обратная частоте монитора. Показывает, сколько времени (в миллисекундах) необходимо для обновления изображения на экране.
  * Для монитора 60Гц, период обновления будет равен 1(с)/60 = 1000(мс)/60 = 16,7(мс)
  * Для монитора 75Гц, период обновления будет равен 1(с)/75 = 1000(мс)/75 = 13,3(мс)
  * Для монитора 120Гц, период обновления будет равен 1(с)/120 = 1000(мс)/120 = 8,3(мс)
  * Для монитора 144Гц, период обновления будет равен 1(с)/144 = 1000(мс)/144 = 6,9(мс)
  * Для монитора 240Гц, период обновления будет равен 1(с)/240 = 1000(мс)/240 = 4,2(мс)
  * Для монитора 360Гц(Asus ROG Swift 360Hz), период обновления будет равен 1(с)/360 = 1000(мс)/360 = 2,8(мс)

* Время отклика(мс) — это сумма времени, необходимого для изменения относительной яркости объекта с 0,1 до 0,9 (время включения) и времени для обратного изменения (время выключения). Относительная яркость при этом определяется как разность мгновенной (в текущий момент времени) и минимальной (монитор включен, на вход подается видеосигнал, соответствующий черному полю) яркостей, отнесённая к разности максимальной (монитор включен, на вход подается видеосигнал, соответствующий белому полю) и минимальной яркостей.
Чем время отклика меньше, тем менее размыто изображение при его смене. Время отклика обязательно должно быть меньше периода обновления монитора. Если это условие не будет соблюдаться, то вместо динамичной сцены мы увидим пиксельное месево.
Для монитора 60Гц, например, вполне допустимо иметь время отклика 5мс, но для монитора 240Гц время отклика должно быть уже меньше 4,2мс.
В общем случае, чем меньше время отклика, тем лучше. 

### Что мы видим на счетчике FPS
Значение счетчика FPS, цифры которого мы видим на экране во время игры, складывается из общего количества разных по времени кадров, сгенерированных за 1с. Какие-то кадры формируются быстрее, т.к. они более простые, кадры же более сложных сцен формируются дольше. Таким образом, кадры по времени распределены неравномерно. 

##### Боевой пример:
Вот вы играете на мониторе с частотой 60Гц с показателем FPS, бОльшим, чем частота монитора, и вдруг почувствовали, что картинка на какое-то время перестала быть плавной, и начала «дергаться».

##### Без ограничения FPS(на 60Гц мониторе):
Предположим, что у нас за секунду было сгенерировано 80 кадров, то есть нам показывает значение 80 FPS.
Из-за неравномерности времени кадров возможна ситуация, когда из 80 кадров 20 кадров сложной сцены заняли каждый по 33,4 мс (в итоге, на эти 20 кадров было затрачено 668 мс), а на остальные 60 кадров пришлось оставшиеся 332 мс(то есть, в среднем, по 332/60 = 5,5 мс на каждый из оставшихся 60-ти кадров).
Соответственно, времена кадров сложной сцены будут по 33,4 мс. При этом на монитор с частотой 60Гц будет выведены те 20 долгих кадров, так как попалась сложная сцена, на отрисовку которой необходимо время, большее, чем период обновления монитора (16,7мс для 60 Гц).
Оставшиеся 60 простых кадров, будут генерироваться очень быстро(по 5,5 мс), и, за период обновления монитора (16,7мс для 60 Гц) будут формироваться аж 3 полных простых кадра(и начинаться формирование 4-го), что приведет к разрыву изображения сразу в нескольких местах.
При этом всём, из-за наличия долгих кадров, будет явно замечен фриз, но цифра FPS будет показывать 80, так как это будет общее кол-во кадров(20 сложных + 60 простых), сгенерированных за 1 секунду.

##### С ограничением FPS(на 60Гц мониторе) без вертикальной синхронизации:
В случае, если бы было установлено ограничение максимального FPS до 60 (без вертикальной синхронизации), то генерация аналогичных сложных кадров заняла бы те же самые 668мс (по 33,4 мс на каждый кадр).
Однако, более простые кадры генерировались бы реже, чтобы выдавать новый кадр монитору спустя 16,7(мс). В данном случае, таких простых кадров было бы сгенерировано 332(мс)/16,7(мс) = 20 штук.
И в этом случае цифра FPS показала бы результат 40, так как общее кол-во кадров, сгенерированное за 1 секунду будет 40 (20 сложных + 20 простых).
При этом визуально будет заметен абсолютно идентичный эффект фриза на сложных кадрах, более сильного ухудшения производительности, по сравнению с вариантом без ограничения FPS не наступит.
Кроме этого, поскольку видеокарте не придется генерировать кадров, чем может вывести монитор, она потребит меньше энергии, меньше нагреется (а значит, потенциально будет более производительной), и, к тому же, на экране вместо нескольких разрывов можно будет увидеть только один.

##### Со включенной вертикальной синхронизацией:
При включенной вертикальной синхронизацией, разрыв кадра вообще пропадает. Видеокарта синхронизируется с монитором, и перестает выдавать лишние кадры. Кроме того, кадр будет выводиться с самого начала и до самого конца. Однако, следует иметь ввиду, что вертикальная синхронизация влечет за собой дополнительные аппаратные расходы, и на слабых компьютерах может вызвать дополнительные падения производительности, а значит и падения FPS.

Исходя из вышеизложенного материала, становится очевидным, что одно только значение FPS не может являться оценкой плавности игры.

Необходимо введение какого-то параметра, который бы определял, насколько часто возникают просадки FPS, и насколько они сильны(насколько велика амплитуда колебаний FPS).

Такие параметры были уже введены, и используются в англоязычном интернете. Это параметры 1% LOW и 0.1% LOW.

Прошу ознакомиться с данными видеороликами, тут более подробно описывается то, что было изложено выше, и раскрывается суть 1% LOW и 0.1% LOW, а так же рассказывается, как их можно посчитать самостоятельно, используя программу FRAPS и MS Excel в качестве инструментов:

[![Что такое меньшие 0,1% и 1% FPS?](https://img.youtube.com/vi/EgKIcFwkhUI/maxresdefault.jpg)](https://www.youtube.com/watch?v=EgKIcFwkhUI)
[![1% & 0.1% Lows Explained!](https://img.youtube.com/vi/l6WgbfG_z-k/maxresdefault.jpg)](https://www.youtube.com/watch?v=l6WgbfG_z-k)
[![FPS не отражает плавность в играх!](https://img.youtube.com/vi/sn1iT9umm6g/maxresdefault.jpg)](https://www.youtube.com/watch?v=sn1iT9umm6g)

## Вывод из теории (текстовой и видео):
На качество изображения и плавность игры влияет и видеокарта, и монитор, и процессор, и частота/тип оперативной памяти.
Количество FPS - не показатель плавности игры. При высоких показателях FPS вполне себе могут происходить фризы, которые будут явно сказываться на игровом процессе.

При варианте без ограничения FPS, средний FPS будет выше, во время игры будут фризы, и FPS будет падать, но благодаря простым кадрам, которые будут идти после сложных, число FPS будет показывать бОльшее значение, чем если бы мы ограничили FPS.
В связи с этим FPS будет "скакать", и это отразит параметр var(он возрастет сильнее, чем при варианте с ограничением FPS до 60). На экране можно будет увидеть одновременно несколько разрывов кадра.

При варианте с ограничением максимального FPS до 60, при тех же самых сценах, будет происходить падение производительности до такого же уровня, как и в варианте без ограничения FPS, то есть фриз не станет дольше по времени, однако, в связи с тем, что количество FPS было ограничено до 60, видеокарта не станет генерировать количество кадров в простых сценах, которое было бы больше, чем монитор может вывести.
Это значит, что FPS за эту секунду покажет меньшее значение, чем у варианта без ограничения FPS.
В данном варианте это приведет к меньшим скачкам значения FPS, а значит параметр var будет колебаться меньше, чем в случае с неограниченным FPS.

### Коротко, из видео: 

1. Микрофризы это кадры которые аномально долго задерживаются на экране. Это происходит недостаточно часто и не настолько надолго, чтобы "длинные" кадры существенно влияли на средний ФПС, но достаточно заметно на глаз.
2. При отсутствии проблем, такие кадры будут довольно редкими. Это всё что вам надо знать. Если вы ничего не поняли про сигмы -- не беда. Нормальное распределение тут вообще не причем.
3. Минимум 0,1% и 1% FPS не показывают FPS в какой-то конкретный момент времени, а показывают какой был бы результат, если бы ваше видео состояло только из самых медленных кадров. Тысячной, или сотой доли от общего количества, соответственно.
4. Для полного счастья эти показатели лучше рассматривать вместе со значением минимального FPS, показанного программой. Потому что, очевидно, просадки от тяжелой сцены не позволят в полной мере оценить кратковременные пролагивания. Впрочем, если вы это понимаете, то можете просто сравнить между собой 0,1% и 1%. Значительная разница между ними также укажет на проблему.
Типа всё хорошо (FPSсредний=50, 1%=49, 0,1%=48) всё плохо (FPSсредний=50, 1%=40, 0,1%=25).

# Практический эксперимент.
Чтобы подтвердить или опровергнуть вышеизложенный материал, предлагаю провести эксперимент, который покажет, что время, затраченное на отрисовку одной и той же сложной сцены не зависит от того, было ли установлено ограничение по частоте FPS, равное частоте монитора.

Для эксперимента понадобятся:

* CS GO (в качестве игры, в которой будет проводиться проверка).

* Fraps (в качестве программы, которая будет записывать в текстовый документ порядковый номер кадра и время его генерации от начала фиксирования). 

* MS Excel или LibreOffice Calc, или любая другая подобная программа для анализа данных, полученных FRAPS-ом.

### Ход эксперимента:

Записать две демки:
На одной будет записан промежуток игры, где сложные сцены проскакивают изредка.
на второй будет записан промежуток игры, где сложные сцены длятся очень большой промежуток времени.
2. Прогнать обе демки:

a) с ограничением FPS,

б) без ограничения, 

ведя запись времен кадров с помощью бенчмарка от FRAPS-а. Режим настроек графики - минимальные настройки. Кол-во повторов: 4.

3. Прогнать обе демки:

а) с ограничением FPS,

б) без ограничения,

ведя запись времен кадров с помощью бенчмарка от FRAPS-а. Режим настроек графики - максимальные настройки. Кол-во повторов: 4.

4. Исследовать полученные наборы данных. Получить несколько наиболее долгих кадров с учетом статистической погрешности. Сравнить между собой значения 2a и 2б. Сравнить между собой значения 3a и 3б.

Ожидаемые результаты:

Ожидается, что для каждой пары демок будут справедливы следующие результаты:

— В случае с ограничением FPS, средний и максимальный FPS будет меньше, чем без ограничения. Кроме того, значение минимального FPS может быть выше, чем без ограничения.

— Время генерации долгих кадров будет одинаковым, либо даже с ограничением FPS время генерации долгих кадров может быть немного меньше, чем без ограничения.

# Источники:
Параметр var в CS GO:
https://steamcommunity.com/sharedfiles/filedetails/?id=972503155
https://kakvigre.ru/var-v-ks-go/

Explanation of the new net_graph:

https://www.reddit.com/r/GlobalOffensive/comments/23zt18/explanation_of_the_new_net_graph_thanks_vitaliy/

Насчет времени отклика:
https://habr.com/ru/post/225829/
Стандарт ISO 13406-2

Объяснения о плавности, времени кадра, 0,1% и 1% FPS:
- Что такое меньшие 0,1% и 1% FPS? : https://www.youtube.com/watch?v=EgKIcFwkhUI

- Распределения | Меньшие 0,1 и 1% | Что это и для чего? : https://www.youtube.com/watch?v=FOmX5fUhpHY

- 1% & 0.1% Lows Explained! : https://www.youtube.com/watch?v=l6WgbfG_z-k

- FPS не отражает плавность в играх! : https://www.youtube.com/watch?v=sn1iT9umm6g 

Влияние частоты оперативной памяти в играх: https://www.youtube.com/watch?v=xmUQFl25Ry0

Разогон монитора: https://www.youtube.com/watch?v=wQolgY6q0eQ&t=66s

Программа FRAPS:
https://www.fraps.com/download.php

Unlock Your Full Potential - How Higher Frame Rates Can Give You An Edge In Battle Royale Games
https://www.nvidia.com/en-us/geforce/news/geforce-gives-you-the-edge-in-battle-royale/

Why Does High FPS Matter For Esports?
https://www.nvidia.com/en-us/geforce/news/what-is-fps-and-how-it-helps-you-win-games/

